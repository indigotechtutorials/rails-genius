#!/usr/bin/ruby

require 'rails_genius'
require 'thor'
require 'pry'

class GetRichCLI < Thor
  class_option :verbose, :type => :boolean, :aliases => "-v"
  def initialize(*args)
    super
    @app_options = {}
  end
  desc "start", "Build your app now! ðŸŽ‰"
  def start
    ask_question :name, "What do you want to name your app?", required: true
    ask_question :framework do 
      """
        What framework do you want to use?
        (tailwind | bootstrap)
        Or leave blank for regular CSS
      """
    end
    ask_question :type, required: true do 
      """
        What type of app do you want to build?
        Options are
      
        (saas) Sell access to your website with Stripe subscriptions
          - User accounts
          - Subscriptions
          - Stripe checkout
      """
    end
    RailsGenius::AppGenerator.new(@app_options).call
  end

  default_task :start
private
  def ask_question(key, question = nil, required: false)
    question = yield if !question
    puts question.split("\n").map { |l| l.strip }.join("\n")
    print "Enter here: "
    answer = gets.chomp.strip
    if answer.empty? && required
      return ask_question(key, question, required: true)
    end
    @app_options[key] = answer
    answer
  end
end

GetRichCLI.start(ARGV)